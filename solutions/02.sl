 .
v#              {0 => depth, 1 => horizontal}
|:p0→0p0→1
|                      >#---------?#-------v
|                    >-+:p"down"=  :←0+→0  |
|            >-o     | >#---------?#------->-+---#-----p
|          >#^ x-----+  :p"up"=    :←0s-→0 | |   :←0←1 :
>R‽#-------+:/ o     >#-----------?#-------^ |         :
| .:dp" "/ >#--^      :p"forward"= :←1+→1    |
|           :d1a-p1+/~                       |
^--------------------------------------------<

  .#-----WH
   :←0←1*
 .
   < Part 1
 ! < Part 2
 v
v#
|:p0→0p0→1p0→2
|                      >#---------?#-------v
|                    >-+:p"down"=  :←0+→0  |
|            >-o     | >#---------?#------->-+---#-----p
|          >#^ x-----+  :p"up"=    :←0s-→0 | |   :←0←1 :
>R‽#-------+:/ o     >#-----------?#-------^ |   :←2   :
| .:dp" "/ >#--^      :p"forward"= :d←1+→1   |         :
|           :d1a-p1+/~             :←0*←2+→2 |
^--------------------------------------------<

  .#-----WH
   :←2←1*
